<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Street Guess</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

<style>
body { margin:0; background:#0f1020; color:#fff; font-family:sans-serif; }
#viewer {
    position:absolute;
    top:0; left:0;
    width:100%; height:100%;
    border:none;
}
#map {
    position:absolute;
    bottom:20px; right:20px;
    width:320px; height:240px;
    border-radius:12px;
    overflow:hidden;
    z-index:10;
}
</style>
</head>

<body>

<iframe id="viewer"></iframe>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
const TOKEN = "MLY|25703375639353602|2d5e13e8a59dbd70a82a07650d8b497c";

// Famous, guaranteed street-level areas
const TARGETS = [
  { lat:40.7589, lng:-73.9840 },  // NYC
  { lat:48.8572, lng:2.2950 },    // Paris
  { lat:35.6597, lng:139.7006 },  // Tokyo
  { lat:51.5033, lng:-0.1196 },   // London
  { lat:-33.8586, lng:151.2140 }  // Sydney
];

async function loadRandomStreetView() {
    const t = TARGETS[Math.floor(Math.random() * TARGETS.length)];
    const d = 0.05; // ~5km

    const bbox = [
        t.lng - d, t.lat - d,
        t.lng + d, t.lat + d
    ].join(",");

    const url =
        `https://graph.mapillary.com/images` +
        `?access_token=${TOKEN}` +
        `&fields=id` +
        `&bbox=${bbox}` +
        `&limit=50`;

    const res = await fetch(url);
    const json = await res.json();

    if (!json.data || !json.data.length) {
        alert("No images found, reload.");
        return;
    }

    const img = json.data[Math.floor(Math.random() * json.data.length)];

    // EMBED VIEWER â€” SIMPLE, STABLE
    document.getElementById("viewer").src =
        `https://www.mapillary.com/embed?image_key=${img.id}&style=photo`;
}

// Guess map
const map = L.map("map", { zoomControl:false }).setView([20,0], 2);
L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png")
  .addTo(map);

map.on("click", e => {
    L.marker(e.latlng).addTo(map);
});

loadRandomStreetView();
</script>

</body>
</html>
